<!DOCTYPE html>
<html>
	<head>
		<meta name="description" content="GMA-1D: 1D Generalized Modes" />
		<script src="javascripts/flot/jquery.js"></script>
		<script src="javascripts/flot/jquery.flot.js"></script>
		<script src="javascripts/main.js"></script>
		<link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
		<title>GMA-1D</title>
	</head>
	
	<body>
		Duffing Equation
		<div id="canvas1" style="width:600px;height:600px;Border:1px solid #aaa;"> </div>
		
		Van Der Pol Oscillator
		
		<div id="canvas2" style="width:600px;height:600px;Border:1px solid #aaa;"> </div>
		
		<script type="text/javascript">
			
			// Simple undamped oscillator
			function DuffingEqn(eps, c)
			{
				var Duffing = function(t,v)
				{
					var v2 = [];
					v2[0] =  v[1];
					v2[1] = -2*c*v[1]-v[0]-eps*Math.pow(v[0],3);
					return v2;
				}
				 return Duffing;
			}
			
			function Ellipse(a,excentricity,angle)
			{
				var ellips = function(t)
				{
					var pt  = [a*Math.cos(t),a*excentricity*Math.sin(t)];
					var c = Math.cos(angle);
					var s = Math.sin(angle);
					var pt2 = [pt[0]*c+pt[1]*s,-pt[0]*s+pt[1]*c];
					return pt2;
				}
				return ellips;
			}
			
			var g = Ellipse(0.5, 1.2, -Math.PI/4.5);
			var pts = linspace(0.0,2*Math.PI,60,g)
			
			var f = DuffingEqn(0.05, 0.2);
			gma = GMA_Mode(f);
			var steps = 500;
			gma.solve(-0.05, 1.0, pts, steps);
			
			var rings = 20;
			var dn = Math.floor(steps/rings);
			var plots = []
			for (var i=0; i<rings; i++)
			{
				plots[i] = {data:gma.getRing(i*dn)}
			}
			var plot = jQuery.plot($("#canvas1"), plots);
			
			
			//var x = [0.0,3.0];
			//var v = solve_ode(f, 0.05, 1.0, x, 300);
			//alert(v.pt);
			//var plot = jQuery.plot($("#canvas1"), [{data:v.pt}]);
			
			function VanDerPol(c)
			{
				var oscillator = function(t,v)
				{
					pt = [v[1], c*(1-v[0]*v[0])*v[1] - v[0]];
					return pt;
				}
				return oscillator;
			}
			
			// First get the limit cycle.
			var vdp = VanDerPol(1,0);
			var x = [-1.53766,-2.0407];
			var v = solve_ode(vdp, 0.0673, 1.0, x, 120);
			
			v.scale = function(sf)
			{
				var pts = [];
				for (var i=0; i<this.pt.length; i++)
				{
					pts[i] = SxV(sf,this.pt[i]);
				}
				return pts;
			}
			
			var pts = v.scale(1.01);
			//var plot = jQuery.plot($("#canvas2"), [{data:v.pt}]);
			
			var gma2 = GMA_Mode(vdp);
			steps = 70;
			gma2.solve(-0.05, 1.0, pts, steps);
			
			rings = 6;
			dn = Math.floor(steps/rings);
			var plots2 = []
			for (var i=0; i<rings; i++)
			{
				plots2[i] = {data:gma2.getRing(i*dn)}
			}
			
			var circle = Ellipse(0.05,1.0,0.0);
			var cirpts = linspace(0.0,2*Math.PI,60,circle)
			
			steps = 250;
			gma2.solve(0.05, 1.0, cirpts, steps);
			dn = Math.floor(steps/rings);
			for (var i=0; i<rings; i++)
			{
				plots2.push({data:gma2.getRing(i*dn)});
			}
			
			var plot = jQuery.plot($("#canvas2"), plots2);
			
			
		</script>
	</body>
</html>
