<!DOCTYPE html>
<html>
	<head>
		<meta name="description" content="GMA-1D: 1D Generalized Modes" />
		<script src="javascripts/flot/jquery.js"></script>
		<script src="javascripts/flot/jquery.flot.js"></script>
		<script src="javascripts/vector.js"></script>
		<script src="javascripts/ODE_Mode.js"></script>
		<link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
		<title>GMA-1D</title>
	</head>
	
	<body>
		<a href="https://github.com/llarsen71/GMA1D"> Git Repository </a>
		<table>
		<tr><td><table>
		<tr><td>Duffing Equation</td>
		<form>
			<select name="model">
				<option value="VanDerPol"> Van Der Pol Oscillator </option>
				<option value="Duffing">   Duffing Oscillator     </option>
			</select>
		</form>
		</tr>
		<tr><td><div id="canvas1" style="width:500px;height:500px;Border:1px solid #aaa;"> </div></td></tr>
		</table></td>
		<td><table>
		<tr><td>Van Der Pol Oscillator</td>
		<form>
			<select name="model">
				<option value="VanDerPol"> Van Der Pol Oscillator </option>
				<option value="Duffing">   Duffing Oscillator     </option>
			</select>
		</form>
		</tr>
		<tr><td><div id="canvas2" style="width:500px;height:500px;Border:1px solid #aaa;"> </div></td></tr>
		</table></td></tr>
		</table>
		
		<script type="text/javascript">
			// Simple undamped oscillator
			function DuffingEqn(eps, c)
			{
				var Duffing = function(t,v)
				{
					var v2 = [];
					v2[0] =  v[1];
					v2[1] = -2*c*v[1]-v[0]-eps*Math.pow(v[0],3);
					return v2;
				}
				 return Duffing;
			}
			
			function Ellipse(a,excentricity,angle)
			{
				var ellips = function(t)
				{
					var pt  = [a*Math.cos(t),a*excentricity*Math.sin(t)];
					var c = Math.cos(angle);
					var s = Math.sin(angle);
					var pt2 = [pt[0]*c+pt[1]*s,-pt[0]*s+pt[1]*c];
					return pt2;
				}
				return ellips;
			}
			
			var g = Ellipse(0.5, 1.2, -Math.PI/4.5);
			var pts = linspace(0.0,2*Math.PI,60,g)
			
			var f = DuffingEqn(0.05, 0.2);
			gma = GMA_Mode(f);
			var steps = 500;
			gma.solve(steps, -0.05, 1.0, pts);
			
			var rings = 20;
			var dn = Math.floor(steps/rings);
			var plots = []
			for (var i=0; i<rings; i++)
			{
				plots[i] = {data:gma.getRing(i*dn)}
			}
			var plot = jQuery.plot($("#canvas1"), plots);
			
			function VanDerPol(c)
			{
				var oscillator = function(t,v)
				{
					pt = [v[1], c*(1-v[0]*v[0])*v[1] - v[0]];
					return pt;
				}
				return oscillator;
			}
			
			// First get the limit cycle.
			var vdp = VanDerPol(1);
			var x = [-1.53766,-2.0407];
			var v = ODE(vdp).solve(120, 0.0673, 1.0, x);
			
			v.scale = function(sf)
			{
				var pts = [];
				for (var i=0; i<this.pts.length; i++)
				{
					pts[i] = SxV(sf,this.pts[i]);
				}
				return pts;
			}
			
			var pts = v.scale(1.01);
			//var plot = jQuery.plot($("#canvas2"), [{data:v.pt}]);
			
			var gma2 = GMA_Mode(vdp);
			steps = 70;
			gma2.solve(steps, -0.05, 1.0, pts);
			
			rings = 6;
			dn = Math.floor(steps/rings);
			var plots2 = []
			for (var i=0; i<rings; i++)
			{
				plots2[i] = {data:gma2.getRing(i*dn)}
			}
			
			var circle = Ellipse(0.05,1.0,0.0);
			var cirpts = linspace(0.0,2*Math.PI,60,circle)
			
			steps = 250;
			gma2.solve(steps, 0.05, 1.0, cirpts);
			dn = Math.floor(steps/rings);
			for (var i=0; i<rings; i++)
			{
				plots2.push({data:gma2.getRing(i*dn)});
			}
			
			plots2.push({data:v.pts,lines:{lineWidth: 3.0}});
			
			var plot = jQuery.plot($("#canvas2"), plots2);
		</script>
	</body>
</html>
